#!/usr/bin/env bash

declare -A emoji
emoji[xx]=âŒ
emoji[check]=âœ…
emoji[todo]=â¬›
emoji[?]=â“
emoji[block]=ğŸš«
emoji[ongoing]=ğŸ”„
emoji[smile]=ğŸ˜ƒ
emoji[idea]=ğŸ’¡
emoji[stop]=ğŸ›‘
emoji[warning]=âš ï¸
emoji[tux]=ğŸ§
emoji[leftarrow]=â†
emoji["<--"]=â†
emoji[rightarrow]=â†’
emoji["-->"]=â†’
emoji[poop]=ğŸ’©
emoji[facepalm]=ğŸ¤¦

toemoji() {
	local in=/dev/stdin
	local out=/dev/stdout
	local file="$1"
	if [[ -n $file ]]; then
		in="$file"
		out="$(mktemp)"
	fi
	IFS=$'\n'
	while read -r line; do
		for k in "${!emoji[@]}"; do
			line=${line//:$k:/${emoji[$k]}}
			[[ $line =~ ^--- ]] && continue
			line=${line//---/â€”}
			line=${line//--\>/â†’}
			line=${line//:bullet:/â€¢}
		done
		echo "$line" >>"$out"
	done <"$in"
	if [[ -n $file ]]; then
		cp "$out" "$file"
		rm "$out"
	fi
}

toemoji "$@"
